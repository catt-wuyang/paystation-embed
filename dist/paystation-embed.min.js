!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self)["paystation-embed"]=e()}(this,(function(){"use strict";function t(t){return null==t}function e(t,e){let n=-1,i=t?t.length:0,o={};for(!i||e||Array.isArray(t[0])||(e=[]);++n<i;){const i=t[n];e?o[i]=e[n]:i&&(o[i[0]]=i[1])}return o}function n(t){return function(){t(arguments),t=function(){}}}function i(t,e){e=e||function(t){return t};let n=[];function i(t){return/ /.test(t)}return{trigger:function(t,n){const i=e(t);try{new CustomEvent(i,{detail:n})}catch(t){document.createEvent("CustomEvent").initCustomEvent(i,!0,!0,n)}document.dispatchEvent(event)}.bind(t),on:function(t,o,s){function c(t,i,o){const s=e(t);document.addEventListener(s,i,o),n.push({name:s,handle:i,options:o})}if(i(t)){t.split(" ").forEach((function(t){c(t,o,s)}))}else c(t,o,s)}.bind(t),off:function(t,o,s){if(!t&&!o&&!s)n.forEach((function(t){document.removeEventListener(t.name,t.handle,t.options)}));else if(i(t)){t.split(" ").forEach((function(t){c(t,o,s)}))}else c(t,o,s);function c(t,i,o){const s=e(t);document.removeEventListener(s,i,o),n=n.filter((function(t){return t.name!==s}))}}.bind(t)}}function o(t){return s._NAMESPACE+"_"+t}function s(t){this.eventObject=i(this,o),this.linkedWindow=t,t.addEventListener&&t.addEventListener("message",function(t){if(t.source!==this.linkedWindow)return;const e={};if("string"==typeof t.data&&void 0!==JSON)try{e=JSON.parse(t.data)}catch(t){}e.command&&this.eventObject.trigger(e.command,e.data)}.bind(this))}s.prototype.eventObject=null,s.prototype.linkedWindow=null,s.prototype.send=function(t,e,n){if(void 0===e&&(e={}),void 0===n&&(n="*"),!this.linkedWindow||void 0===this.linkedWindow.postMessage||void 0===window.JSON)return!1;try{this.linkedWindow.postMessage(JSON.stringify({data:e,command:t}),n)}catch(t){}return!0},s.prototype.on=function(t,e,n){this.eventObject.on(t,e,n)},s.prototype.off=function(t,e,n){this.eventObject.off(t,e,n)},s._NAMESPACE="POST_MESSAGE";var c="1.2.8";function r(t){this.eventObject=i(this,E),this.options=t?h:l,this.message=null}const a="xpaystation-widget-lightbox",d={zIndex:1e3,overlayOpacity:".6",overlayBackground:"#000000",contentBackground:"#ffffff",closeByKeyboard:!0,closeByClick:!0,modal:!1,spinner:"xsolla",spinnerColor:null,spinnerUrl:null,spinnerRotationPeriod:0},l=Object.assign({},d,{width:null,height:"100%",contentMargin:"10px"}),h=Object.assign({},d,{width:"100%",height:"100%",contentMargin:"0px"}),u={xsolla:"",round:"",none:""},f={height:500,width:600},p=E("keyup"),g=E("resize"),y=function(t){const e=document.createEvent("Event");e.initEvent(p,!1,!0),e.sourceEvent=t,document.body.dispatchEvent(e)},v=function(t){27==t.sourceEvent.which&&this.closeFrame()},m=function(){const t=document.createEvent("Event");t.initEvent(g,!1,!0),window.dispatchEvent(t)};function E(t){return r._NAMESPACE+"_"+t}function w(){this.eventObject=i(this,b),this.message=null}function b(t){return w._NAMESPACE+"_"+t}r.prototype.triggerEvent=function(){this.eventObject.trigger.apply(this.eventObject,arguments)},r.prototype.measureScrollbar=function(){const t=document.createElement("div");t.classList.add("scrollbar-measure"),t.setAttribute("style","position: absolute;top: -9999pxwidth: 50pxheight: 50pxoverflow: scroll"),document.body.appendChild(t);const e=t.offsetWidth-t.clientWidth;return document.body.removeChild(t),e},r.prototype.openFrame=function(t,i){this.options=Object.assign({},this.options,i);const o=v.bind(this),r="custom"===(i=this.options).spinner&&i.spinnerUrl?'<img class="spinner-custom" src="'+encodeURI(i.spinnerUrl)+'" />':u[i.spinner]||Object.values(u)[0],d=document.body,l=function(t){const e=document.createElement("div");e.className=t.prefix;const n=document.createElement("div");n.className=t.prefix+"-overlay";const i=document.createElement("div");i.className=t.prefix+"-content "+t.prefix+"-content__hidden";const o=document.createElement("iframe");o.className=t.prefix+"-content-iframe",o.src=t.url,o.frameBorder="0",o.allowFullscreen=!0;const s=document.createElement("div");return s.className=t.prefix+"-spinner",s.innerHTML=t.spinner,i.appendChild(o),e.appendChild(n),e.appendChild(i),e.appendChild(s),e}({prefix:a,url:t,spinner:r}),h=l.querySelector("."+a+"-overlay"),E=l.querySelector("."+a+"-content"),w=E.querySelector("."+a+"-content-iframe"),b=l.querySelector("."+a+"-spinner"),O={width:T(f.width),height:T(f.height)};function T(t){return"string"==typeof t&&String(parseFloat(t)).length===t.length||"number"==typeof t?t+"px":t}if(l.style.zIndex=i.zIndex,h.style.opacity=i.overlayOpacity,h.style.backgroundColor=i.overlayBackground,E.style.backgroundColor=i.contentBackground,E.style.margin=T(i.contentMargin),E.style.width=i.width?T(i.width):"auto",E.style.height=i.height?T(i.height):"auto",i.spinnerColor&&(b.querySelector("path").style.fill=i.spinnerColor),"custom"===i.spinner){const t=b.querySelector(".spinner-custom");t.style["-webkit-animation-duration"]=i.spinnerRotationPeriod+"s;",t.style["animation-duration"]=i.spinnerRotationPeriod+"s;"}i.closeByClick&&h.addEventListener("click",function(){this.closeFrame()}.bind(this)),d.appendChild(l),i.closeByKeyboard&&(d.addEventListener(p,o),d.addEventListener("keyup",y,!1));const S=n(function(){L(),E.classList.remove(a+"-content__hidden"),this.triggerEvent("load")}.bind(this)),_=function(){const t=i.width?i.width:O.width,e=i.height?i.height:O.height;E.style.left="0px",E.style.top="0px",E.style.borderRadius="8px",E.style.width=T(t),E.style.height=T(e);const n=l.clientWidth,o=l.clientHeight,s=function(t){const e=t.offsetWidth,n=getComputedStyle(t);return e+=parseInt(n.marginLeft)+parseInt(n.marginRight),e}(E),c=function(t){const e=t.offsetHeight,n=getComputedStyle(t);return e+=parseInt(n.marginTop)+parseInt(n.marginBottom),e}(E),r=s-E.offsetWidth,a=c-E.offsetHeight,d=n-s,h=o-c;d<0?E.style.width=n-r+"px":E.style.left=Math.round(d/2)+"px",h<0?E.style.height=o-a+"px":E.style.top=Math.round(h/2)+"px"};let C;i.width&&i.height&&(_=n(_.bind(this)));const x=function(){C=e(["overflow","paddingRight"].map((function(t){return[t,getComputedStyle(d)[t]]})));const t=parseInt(getComputedStyle(d).paddingRight||0,10);d.style.overflow="hidden",d.style.paddingRight=T(t+this.measureScrollbar())}.bind(this),L=function(){b.style.display="none"};w.addEventListener("load",(function t(e){const n=i.width&&i.height?1e3:i.resizeTimeout||3e4;setTimeout((function(){_(),S()}),n),w.removeEventListener("load",t)}));const W=w.contentWindow||w;this.message=new s(W),i.width&&i.height?this.message.on("dimensions",(function(){_(),S()})):this.message.on("dimensions",(function(t){const n=t.detail;n.dimensions&&(O=e(["width","height"].map((function(t){return[t,Math.max(f[t]||0,n.dimensions[t]||0)+"px"]}))),_()),S()})),this.message.on("widget-detection",function(){this.message.send("widget-detected",{version:c,lightBoxOptions:i})}.bind(this)),this.message.on("widget-close",function(){this.closeFrame()}.bind(this)),this.message.on("close",function(){this.closeFrame()}.bind(this)),this.message.on("status",function(t){this.triggerEvent("status",t.detail)}.bind(this)),this.message.on("user-country",function(t){this.triggerEvent("user-country",t.detail)}.bind(this)),window.addEventListener(g,_),window.addEventListener("resize",m);const N=this;this.on("close",(function t(e){N.message.off(),d.removeEventListener(p,o),d.removeEventListener("keyup",y),window.removeEventListener("resize",m),window.removeEventListener(g,_),l.parentNode.removeChild(l),C&&Object.keys(C).forEach((function(t){d.style[t]=C[t]})),N.off("close",t)})),b.style.display="block",x(),this.triggerEvent("open")},r.prototype.closeFrame=function(){this.options.modal||this.triggerEvent("close")},r.prototype.close=function(){this.closeFrame()},r.prototype.on=function(){this.eventObject.on.apply(this.eventObject,arguments)},r.prototype.off=function(){this.eventObject.off.apply(this.eventObject,arguments)},r.prototype.getPostMessage=function(){return this.message},r._NAMESPACE=".xpaystation-widget-lightbox";const O={target:"_blank"};function T(t){this.message=t,this.name="XsollaPayStationWidgetException",this.toString=function(){return this.name+": "+this.message}.bind(this)}function S(){}function _(){this.config=Object.assign({},C),this.eventObject=i(this),this.isInitiated=!1,this.postMessage=null,this.childWindow=null}w.prototype.eventObject=null,w.prototype.childWindow=null,w.prototype.triggerEvent=function(t,e){this.eventObject.trigger(t,e)},w.prototype.open=function(t,e){e=Object.assign({},O,e),this.childWindow&&!this.childWindow.closed&&(this.childWindow.location.href=t);const n=this,i=function(){n.on("close",(function t(){timer&&clearTimeout(timer),n.childWindow&&n.childWindow.close(),n.off("close",t)})),n.message=new s(n.childWindow),n.message.on("dimensions widget-detection",(function t(){n.triggerEvent("load"),n.message.off("dimensions widget-detection",t)})),n.message.on("widget-detection",(function t(){n.message.send("widget-detected",{version:c,childWindowOptions:e}),n.message.off("widget-detection",t)})),n.message.on("status",(function(t){n.triggerEvent("status",t.detail)})),n.on("close",(function t(){n.message.off(),n.off("close",t)})),n.message.on("user-country",(function(t){n.triggerEvent("user-country",t.detail)}))};switch(e.target){case"_self":this.childWindow=window,i(),this.childWindow.location.href=t;break;case"_parent":this.childWindow=window.parent,i(),this.childWindow.location.href=t;break;default:this.childWindow=window.open(t),this.childWindow.focus(),i();const e=function(){this.childWindow&&(this.childWindow.closed?this.triggerEvent("close"):n=setTimeout(e,100))}.bind(this),n=setTimeout(e,100)}this.triggerEvent("open")},w.prototype.close=function(){this.triggerEvent("close")},w.prototype.on=function(t,e,n){"function"==typeof e&&this.eventObject.on(t,e,n)},w.prototype.off=function(t,e,n){this.eventObject.off(t,e,n)},w.prototype.getPostMessage=function(){return this.message},w._NAMESPACE="CHILD_WINDOW",S.prototype.isMobile=function(){return!1},_.eventTypes={INIT:"init",OPEN:"open",OPEN_WINDOW:"open-window",OPEN_LIGHTBOX:"open-lightbox",LOAD:"load",CLOSE:"close",CLOSE_WINDOW:"close-window",CLOSE_LIGHTBOX:"close-lightbox",STATUS:"status",STATUS_INVOICE:"status-invoice",STATUS_DELIVERING:"status-delivering",STATUS_TROUBLED:"status-troubled",STATUS_DONE:"status-done",USER_COUNTRY:"user-country"};const C={access_token:null,access_data:null,sandbox:!1,lightbox:{},childWindow:{},host:"secure.xsolla.com",iframeOnly:!1};let x;_.prototype.config={},_.prototype.isInitiated=!1,_.prototype.eventObject=i(void 0),_.prototype.getPaymentUrl=function(){if(this.config.payment_url)return this.config.payment_url;const t={};this.config.access_token?t.access_token=this.config.access_token:t.access_data=JSON.stringify(this.config.access_data);return(this.config.sandbox?"https://sandbox-secure.xsolla.com/paystation2/?":"https://"+this.config.host+"/paystation2/?")+function(t){const e=[],n=function(t,n){n=null==(n="function"==typeof n?n():n)?"":n,e[e.length]=encodeURIComponent(t)+"="+encodeURIComponent(n)},i=function(t,o){let s,c,r;if(t)if(Array.isArray(o))for(s=0,c=o.length;s<c;s++)i(t+"["+("object"==typeof o[s]&&o[s]?s:"")+"]",o[s]);else if("[object Object]"===String(o))for(r in o)i(t+"["+r+"]",o[r]);else n(t,o);else if(Array.isArray(o))for(s=0,c=o.length;s<c;s++)n(o[s].name,o[s].value);else for(r in o)i(r,o[r]);return e};return i("",t).join("&")}(t)},_.prototype.checkConfig=function(){t(this.config.access_token)&&t(this.config.access_data)&&t(this.config.payment_url)&&this.throwError("No access token or access data or payment URL given"),t(this.config.access_data)||"object"==typeof this.config.access_data||this.throwError("Invalid access data format"),t(this.config.host)&&this.throwError("Invalid host")},_.prototype.checkApp=function(){void 0===this.isInitiated&&this.throwError("Initialize widget before opening")},_.prototype.throwError=function(t){throw new T(t)},_.prototype.triggerEvent=function(t,e){1===arguments.length?[].forEach.call(arguments,function(t){const e=document.createEvent("HTMLEvents");e.initEvent(t,!0,!1),document.dispatchEvent(e)}.bind(this)):this.eventObject.trigger(t,e)},_.prototype.triggerCustomEvent=function(t,e){try{new CustomEvent(t,{detail:e})}catch(n){document.createEvent("CustomEvent").initCustomEvent(t,!0,!0,e)}document.dispatchEvent(event)},_.prototype.init=function(t){var e;e=function(t){this.isInitiated=!0,this.config=Object.assign({},C,t);const e=document.body,n="click.xpaystation-widget",i=function(t){const e=document.querySelector("[data-xpaystation-widget-open]");t.sourceEvent.target===e&&this.open.call(this,e)}.bind(this);e.removeEventListener(n,i);const o=document.createEvent("Event");o.initEvent(n,!1,!0),e.addEventListener("click",function(t){o.sourceEvent=t,e.dispatchEvent(o)}.bind(this),!1),e.addEventListener(n,i),this.triggerEvent(_.eventTypes.INIT)}.bind(this,t),"loading"!==document.readyState?e():document.addEventListener("DOMContentLoaded",e)},_.prototype.open=function(){this.checkConfig(),this.checkApp();const t=function(t){switch(((t||{}).paymentInfo||{}).status){case"invoice":this.triggerEvent(_.eventTypes.STATUS_INVOICE,t);break;case"delivering":this.triggerEvent(_.eventTypes.STATUS_DELIVERING,t);break;case"troubled":this.triggerEvent(_.eventTypes.STATUS_TROUBLED,t);break;case"done":this.triggerEvent(_.eventTypes.STATUS_DONE,t)}}.bind(this),e=this.getPaymentUrl(),n=this;function i(e){const i=e.detail;n.triggerEvent(_.eventTypes.STATUS,i),t(i)}function o(t){const e={user_country:t.detail.user_country};n.triggerCustomEvent(_.eventTypes.USER_COUNTRY,e)}if(this.postMessage=null,(new S).isMobile()&&!this.config.iframeOnly){const t=new w;t.on("open",(function e(){n.postMessage=t.getPostMessage(),n.triggerEvent(_.eventTypes.OPEN),n.triggerEvent(_.eventTypes.OPEN_WINDOW),t.off("open",e)})),t.on("load",(function e(){n.triggerEvent(_.eventTypes.LOAD),t.off("load",e)})),t.on("close",(function e(){n.triggerEvent(_.eventTypes.CLOSE),n.triggerEvent(_.eventTypes.CLOSE_WINDOW),t.off("status",i),t.off(_.eventTypes.USER_COUNTRY,o),t.off("close",e)})),t.on("status",i),t.on(_.eventTypes.USER_COUNTRY,o),t.open(e,this.config.childWindow),n.childWindow=t}else{const t=new r((new S).isMobile()&&this.config.iframeOnly);t.on("open",(function e(){n.postMessage=t.getPostMessage(),n.triggerEvent(_.eventTypes.OPEN),n.triggerEvent(_.eventTypes.OPEN_LIGHTBOX),t.off("open",e)})),t.on("load",(function e(){n.triggerEvent(_.eventTypes.LOAD),t.off("load",e)})),t.on("close",(function e(){n.triggerEvent(_.eventTypes.CLOSE),n.triggerEvent(_.eventTypes.CLOSE_LIGHTBOX),t.off("status",i),t.off(_.eventTypes.USER_COUNTRY,o),t.off("close",e)})),t.on("status",i),t.on(_.eventTypes.USER_COUNTRY,o),t.openFrame(e,this.config.lightbox),n.childWindow=t}},_.prototype.close=function(){this.childWindow.close()},_.prototype.on=function(t,e,n){if("function"!=typeof e)return;this.eventObject.on(t,(function(t){e(t,t.detail)}),n)},_.prototype.off=function(t,e,n){this.eventObject.off(t,e,n)},_.prototype.sendMessage=function(t,e){this.postMessage&&this.postMessage.send.apply(this.postMessage,arguments)},_.prototype.onMessage=function(t,e){this.postMessage&&this.postMessage.on.apply(this.postMessage,arguments)};const L=Object.assign(e(["init","open","close","on","off","sendMessage","onMessage"].map((function(t){const e=(x||(x=new _),x);return[t,function(){return e[t].apply(e,arguments)}]}))),{eventTypes:_.eventTypes});return L}));
//# sourceMappingURL=paystation-embed.min.js.map
